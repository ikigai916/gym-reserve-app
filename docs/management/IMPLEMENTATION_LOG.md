# 実装ログ (IMPLEMENTATION LOG)

## 2025-12-27: JWT認証と30分単位の予約エンジンの実装

### 変更の背景
- プロトタイプ版として、外部依存のないJWT認証基盤を構築。
- ビジネスルールに基づき、30分単位の枠管理と前日24時期限を厳密に実装。

### 主要な変更点
1. **認証基盤**: `app/core/auth.py` にJWT生成・検証ロジックを実装。パスワードは bcrypt でハッシュ化。
2. **稼働枠管理**: `availabilities` コレクションを導入。トレーナーが30分単位で稼働枠を一括登録できるAPIを実装。
3. **予約エンジン**: 
   - 連続スロット確保ロジック（コース時間に応じた複数スロットの占有）。
   - 前日24時までの期限チェックバリデーション。
   - Firestoreトランザクションによるアトミックな予約処理。
4. **フロントエンド**: `Zen Conditioning` のブランドに合わせたミニマルなデザインに刷新。コース選択と30分単位の枠表示に対応。

### 技術的決定
- プロトタイプ速度を優先し、メールアドレス/パスワード認証を独自実装（パスワードはハッシュ化）。
- UIの状態管理には Alpine.js を継続採用し、軽量さを維持。

---

## 2025-12-27: ビジネスルールの詳細化とドキュメント一新

### 変更の背景
- HP（Zen Conditioning / Kukan）の内容に基づき、より実務に即した要件にアップデート。
- 30分単位の予約、前日24時の期限、55分セッション等の重要な制約を定義。

### 主要な定義
1. **予約期限**: 30日前〜1日前24時まで。
2. **稼働管理**: トレーナーが自身の空き枠（Availability）を登録し、それを顧客が予約する方式を採用。
3. **認証方針**: 将来の拡張性を考慮し、ID/パスワードによるセキュアな方式へシフト。

### 技術적決定
- Firestore に `availabilities` コレクションを追加。
- 予約時には、複数の30分スロットを「束」として扱うロジックを実装予定。
