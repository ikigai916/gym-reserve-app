# 実装ログ (IMPLEMENTATION LOG)

## 2025-12-27: JWT認証と30分単位の予約エンジンの実装

### 変更の背景
- プロトタイプ版として、外部依存のないJWT認証基盤を構築。
- ビジネスルールに基づき、30分単位の枠管理と前日24時期限を厳密に実装。

### 主要な変更点
1. **認証基盤**: `app/core/auth.py` にJWT生成・検証ロジックを実装。パスワードは bcrypt でハッシュ化。
2. **稼働枠管理**: `availabilities` コレクションを導入。トレーナーが30分単位で稼働枠を一括登録できるAPIを実装。
3. **予約エンジン**: 
   - 連続スロット確保ロジック（コース時間に応じた複数スロットの占有）。
   - 前日24時までの期限チェックバリデーション。
   - Firestoreトランザクションによるアトミックな予約処理。
4. **フロントエンド**: `Zen Conditioning` のブランドに合わせたミニマルなデザインに刷新。コース選択と30分単位の枠表示に対応。

### 技術的決定
- プロトタイプ速度を優先し、メールアドレス/パスワード認証を独自実装（パスワードはハッシュ化）。
- UIの状態管理には Alpine.js を継続採用し、軽量さを維持。

---

## 2025-12-27: 本番環境での API Fetch エラー修正と運用プロセスの是正

### 変更の背景
- 本番環境（Cloud Run）において、APIエンドポイントの末尾スラッシュ欠如により「Failed to fetch」エラーが発生していた。
- 緊急修正時にルール（Issue/ブランチ作成）を逸脱したため、事後にプロセスを遡及適用し履歴を整理。

### 主要な変更点
1. **API呼び出しパスの修正**: `index.html` 内のすべての `fetch` パスに末尾スラッシュを追加（例: `/api/availabilities/`）。
2. **プロセス是正**:
   - Issue #28 起票
   - 修正用ブランチ `fix/28-trailing-slash-fetch-error` 作成
   - PR #29 によるマージ記録の作成

### 技術的決定
- FastAPIのリダイレクト（307）によるFetchエラーを回避するため、リクエストパスをサーバー側の定義に厳密に合わせる方針を徹底。
